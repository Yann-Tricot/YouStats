<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <title>Test      </title>

      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!--Nouveaux imports-->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>  -->
      <!--Générateur de pdf -->
      {# <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
      <!--Double click et autre fonctionnalités (je pense)-->
      <script type="text/javascript"  src="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.js" defer></script>
      <script type="text/javascript"  src="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.js"></script>
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.css" />
      <!--Le tableau en lui meme--> #}
      <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" defer ></script>
      <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js" defer></script>
      <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" defer></script> 
      <!--Import des boutons-->
      <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js" defer></script>
      <script src="https://cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js" defer></script>
      <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js" defer></script>
      <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js" defer></script>  
      <script src="https://cdn.datatables.net/colreorder/1.5.3/js/dataTables.colReorder.min.js" defer></script>  
      <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script> 


      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.css"/>
      
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
      <script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.js"></script>



   </head>
   <body>
  

   <!-- modal -->
    
         

       <div class="modal " id="modalTab" role="dialog">
            <div class="modal-dialog modal-lg" >
               <div class="modal-content">
                  <div class="modal-header">
                     <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">�</button> -->
                     <h3 class="modal-title">Video</h3>
                  </div>
                  <div class="modal-body">
                     <div class="container">
                        <div class="row">
                           <div id="imageMiniature" class="col"></div>
                           <div class="col">
                              <h5>Titre : </h5>
                              <div id="titre">
                              </div>

                              <h5 >Chaine</h5>
                              <div id="chaine">    </div>
                           </div>
                     </div>
                     <div class="row">
                        <div class="col">
                         <div class="card">
                              <div class="card-body">
                                 <div class="table-responsive">
                                    <table >
                                       <tbody>
                                         
                                          <tr>
                                             <td>Tag :</td>
                                             <td id ="tag"> </td>
                                          </tr>
                                          <tr>
                                              <td>Pays : </td>                                          
                                             <td id ="pays"> Tag </td>
                                          </tr>
                                          <tr>
                                              <td>Catégorie : </td>
                                             <td id ="cat"> Tag </td>
                                          </tr>                                      
                                          <tr>
                                            <td>Nombre de commentaires : </td>
                                             <td id ="comment"> Tag </td>
                                          </tr>
                                          <tr>
                                            <td>Nombre de j'aime : </td>
                                             <td id ="like"> Tag </td>
                                          </tr>
                                          <tr>
                                            <td>Nombre de j'aime pas : </td>
                                             <td id ="dislike"> Tag </td>
                                          </tr>
                                          <tr>
                                           <td>Date de publication : </td>
                                             <td id ="published"> Tag </td>
                                          </tr>
                                          <tr>
                                            <td>Date de tendance : </td>
                                             <td id ="trending"> Tag </td>
                                          </tr>
                                    </table>
                                 </div>
                              </div>
                           </div> 
                        </div>                        
                        <div class="col">
                            <canvas id="chartModal" width="400" height="400"></canvas>
                        </div>
                     </div>
                     <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                     </div>
                  </div>
                  <!-- /.modal-content -->
               </div>
               <!-- /.modal-dialog -->
            </div>
         </div>
      </div>
<div class="container">
      <div class="row">
         <div class="col-sm-8">
            <table class="table" id="myDatatable">
               <thead>
                  <tr>
                     <th><strong>Titre de la vidéo</strong></th>
                    <th><strong>Durée</strong></th>
                     <th><strong>Classement</strong></th>
                     <th><strong>Nombre de vues</strong></th>
                     <th><strong>ID</strong></th>
                     <th><strong>Tag ID</strong></th>
                     <th><strong>Pays</strong></th>
                     <th><strong>Channel ID</strong></th>
                     <th><strong>Catégorie ID</strong></th>
                     <th><strong>Nombre de commentaire</strong></th>
                     <th><strong>Nombre de j'aime</strong></th>
                     <th><strong>Nombre de j'aime pas </strong></th>
                     <th><strong>Date de publication</strong></th>
                     <th><strong>Date de tendance</strong></th>
                     <th><strong>MiniatureLink</strong></th>
                  </tr>
               </thead>
               <tbody>
               </tbody>
               <tfoot>
                  <tr>
                     <th><strong>Titre de la vidéo</strong></th>
                     <th><strong>Durée</strong></th>
                     <th><strong>Classement</strong></th>
                     <th><strong>Nombre de vues</strong></th>
                     <th><strong>ID</strong></th>
                     <th><strong>Tag ID</strong></th>
                     <th><strong>Pays</strong></th>
                     <th><strong>Channel ID</strong></th>
                     <th><strong>Catégorie ID</strong></th>
                     <th><strong>Nombre de commentaire</strong></th>
                     <th><strong>Nombre de j'aime</strong></th>
                     <th><strong>Nombre de j'aime pas </strong></th>
                     <th><strong>Date de publication</strong></th>
                     <th><strong>Date de tendance</strong></th>
                     <th><strong>MiniatureLink</strong></th>
                  </tr>
               </tfoot>
            </table>
         </div>

<div class="col-sm-4">
    <div class="card">
      <div class="card-header"><span>Durée Moyenne</span></div>
      <div class="card-body">
      <canvas id="chartCategory" width="400" height="400"></canvas>
      </div>
  </div> 
  <div class="card">
      <div class="card-header"><span>Durée Moyenne</span></div>
      <div class="card-body">
      <canvas id="chartDuration" width="400" height="400"></canvas>      
      </div>
  </div>
  

 
      <div class="card">
        <div class="card-header"><span>Catégorie</span></div>
        <div class="card-body">
          <div class="row align-items-center no-gutters">
            <div class="col mr-2">
              <div class="text-uppercase text-primary font-weight-bold text-xs mb-1">
              </div>
              <div class="text-dark font-weight-bold h5 mb-0" id="Producteurs"><span></span>
              </div>
            </div>
              <div class="col-auto"><i class="icon ion-person-stalker fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



         
   </body>
      
      
      <script>
      



      var options = {
        title: {
                  display: true,
                  text: "Proportion de J'aime / J'aime pas ",
                  position: 'top',

              },
              animation : {
                duration : 500,
                easing : 'easeInCirc'
              },
              
    };
             
      

      
        var data2 = {
            labels: ["Nombre de j'aime", "Nombre de j'aime pas"],
              datasets: [
                {
                    fill: true,
                    backgroundColor: [
                        'green',
                        'red'],
                    data: [5, 95],
        // Notice the borderColor 
                    borderColor:	['black', 'black'],
                    borderWidth: [2,2]
                }
            ]
        };


          var ctx= document.getElementById("chartModal").getContext("2d");
          var chartModal = new Chart(ctx, {
                type: 'doughnut',
                data: data2,
                options: options
            });


      var videos = [];
      var categories = [];

        {% for v in 0..99%}
        var object = {
          "Title" : "{{videos[loop.index0].getVidTitle}}",
          "Id" : "{{videos[loop.index0].getId}}",
          "Tag" : "{{videos[loop.index0].getVidTagId}}",
          "Country" : "{{videos[loop.index0].getVidCountry}}",
          "ChannelId" : "{{videos[loop.index0].getVidChannelId}}",
          "CategoryId" : "{{videos[loop.index0].getVidCategoryId}}",
          "CommentCount" : "{{videos[loop.index0].getVidCommentCount}}",
          "DislikeCount": "{{videos[loop.index0].getVidDislikeCount}}",
          "LikeCount" : "{{videos[loop.index0].getVidLikeCount}}",
          "PublishedDate" : "{{videos[loop.index0].getVidPublishDate|date('d-m-Y')}}",
          "MiniatureLink" : "{{videos[loop.index0].getMiniatureLink}}",
          "TrendingDate :" : "{{videos[loop.index0].getVidTrendingDate|date('d-m-Y')}}",
          "Duration" : "{{videos[loop.index0].getDuration}}",
          "Classement" : "{{videos[loop.index0].getClassement}}",
          "Views" : "{{videos[loop.index0].getCountView}}"

        }; 

          videos.push(object);

          categories.push("{{videos[loop.index0].getVidCategoryId}}");


        {% endfor %}       

        var orderCategories = {};
        categories.forEach(function(i) { orderCategories[i] = (orderCategories[i]||0) + 1;});
        console.log(orderCategories[1]);
        

        createChart(categories);
        var cors = "https://cors-anywhere.herokuapp.com/";   

        $(document).ready(function () {
          
          $('#myDatatable').DataTable({
            data: videos,
            dom :"Bfrtip",
            autoWidth : false,
            columns: [ 
              {
                data: "Title",    
                defaultContent: '-',
                width : "20px"            
              },
              {
                data: "Duration",  
                width : "1px"
              },
               {
                data: "Classement",  
                width : "5%"
              }, 
              {
                data: "Views",  
                width : "5%"
              },
              {
                data: "Id",  
                width : "5%"
              },
              {
                data: "Tag", 
                width : "5%"
              },
              {
                data: "Country",
                width : "5%"
              }, 
              {
                data: "ChannelId",
                width : "20%"
              },
              {
                data: "CategoryId",        
                width : "20%"        
              },
              {
                data: "CommentCount", 
                width : "20%"
              }, 
              {
                data: "LikeCount",
                width : "20%"
              },
              {
                data: "DislikeCount",
                width : "20%"
              },
              {
                data: "PublishedDate", 
                width : "20%"
              },
              {
                data: "TrendingDate :",
                width : "20%"
              },
                {
                data: "MiniatureLink",
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                $(nTd).html("<a target=_blank href='"+sData+"'>"+sData+"</a>");
                },
                
             },           
            
            ],

            responsive: true,
            paging: true,
            fixedHeader: true,
            searching: true,
            colReorder: true,
            select: true,
            keys: true,
            scrollX : true,
            details : true,
            paginate:
            {
              "previous": "Previous page"
            },
            rowReorder: false,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
            pageLength: 15,
            initComplete: function () {
              this.api().columns().every(function () {
                var that = this;                
                $('input', this.footer()).on('keyup change clear', function () {
                  if (that.search() !== this.value) {
                    that
                    .search(this.value)
                    .draw();
                  }
                });
              });
            },
            buttons: [
            { extend: 'csv', className: 'btn btn-secondary testBouton' },
            { extend: 'excel', className: 'btn btn-secondary testBouton' },
            { extend: 'pdfHtml5', className: 'btn btn-secondary testBouton', orientation: 'landscape', pageSize: 'A3' },
            { extend: 'print', className: 'btn btn-secondary testBouton' },
            ]
          })
        });      
        
        
        $('#myDatatable tfoot th').each(function () {
          var title = $('table tfoot th').eq($(this).index()).text();
          $(this).html('<input type="text" placeholder="Search ' + title + '" />');
        });
        
        $.extend(true, $.fn.dataTable.defaults, {
          columnDefs: [
          {
            targets: '_all',
            defaultContent: '-'
          }
          ],
          language: {
            processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>Processing...'
          },
        });


        $('#myDatatable tbody').on('dblclick', 'tr', function (e, dt, type, indexes) {  

          //évite les bugs 
          if (e.currentTarget.className != "child" )
          {
            
            
            var lien = cors + videos["MiniatureLink"];
            var lien2 = cors + "https://www.google.com/url?sa=i&url=https%3A%2F%2Fdeveloper.mozilla.org%2Ffr%2Fdocs%2FWeb%2FHTML%2FElement%2FImg&psig=AOvVaw18gr0YP4N_5daIKW_ssPag&ust=1606481499287000&source=images&cd=vfe&ved=0CAIQjRxqFwoTCKC8_JagoO0CFQAAAAAdAAAAABAD";
            var elt = document.getElementById("imageMiniature");
            elt.innerHTML = '';
            var titre = $('td', this).eq(0).text();
            var duree = $('td', this).eq(1).text();
            var classement = $('td', this).eq(2).text();
            var viewCount = $('td', this).eq(3).text();
            var id =  $('td', this).eq(4).text();
            var tagId =  $('td', this).eq(5).text();
            var country = $('td', this).eq(6).text();
            var channelID =  $('td', this).eq(7).text();
            var categoryID =  $('td', this).eq(8).text();
            var CommentCount = + $('td', this).eq(9).text();
            var LikeCount = $('td', this).eq(10).text();
            var DislikeCount =  $('td', this).eq(11).text();
            var PublishedDate = $('td', this).eq(12).text();
            var TrendingDate =  $('td', this).eq(13).text();
            var link = cors + $('td', this).eq(14).text();

            var testLike = videos[classement-1];

            var nbLike = testLike["LikeCount"];
            var nbDislike =testLike["DislikeCount"];
            updateChart(chartModal,nbLike,nbDislike);


            $('#modalTab').modal("show");
            $('#titre').text(titre);
            $('#chaine').text(id);
            $('#tag').text(tagId);
            $('#pays').text(country);
            $('#cat').text(categoryID);
            $('#comment').text(CommentCount);
            $('#like').text(LikeCount);
            $('#dislike').text(DislikeCount);
            $('#published').text(PublishedDate);
            $('#trending').text(TrendingDate);
         

            var img = document.createElement("img");
            img.crossOrigin = "anonymous";
            img.src = link;
            img.setAttribute('width', '100%');
            img.setAttribute('height', '100%');
            elt.appendChild(img);


           


          }

        });

       

        
          function createChart(categories)
          {
            console.log(categories);
            var ctx1= document.getElementById("chartCategory").getContext("2d");
            console.log(ctx1);
            
          }

          function updateChart(chartModal,like,dislike)
          {


            var dt = [
                {
                    fill: true,
                    backgroundColor: [
                        'red',
                        'blue'],
                    data: [5, 95],
        // Notice the borderColor 
                    borderColor:	['white', 'white'],
                    borderWidth: [2,2]
                }
            ];
            chartModal.data.datasets[0].data[0] = like;
            chartModal.data.datasets[0].data[1] = dislike;
            chartModal.update();

          }

      </script>
      
      <style>

      li[data-dtr-index='11'] {
          visibility : hidden;  
        }

        .dataTables_processing {
          z-index: 3000;
        }
        
        .btn-primary {
          background-color: #4e73df;
          border-color: #4e73df;
          left: 25px;
        }
        
        .ui-state-active {
          background-color: rgba(97, 134, 255, 0.993);
          color: black;
          font-weight: bold;
        }
        
        .ui-autocomplete {
          max-height: 200px;
          overflow-y: scroll;
          overflow-x: hidden;
        }
        
        .list-group-item {
          right: 20px;
        }
        
        /* couleur des boutons */
        .testBouton {
          background-color: rgb(201, 128, 19);
          border-color: rgb(201, 128, 19);
        }
        
        
        /* couleur des boutons plus et moins */
        table.dataTable.dtr-inline.collapsed>tbody>tr[role="row"]>td:first-child:before,
        table.dataTable.dtr-inline.collapsed>tbody>tr[role="row"]>th:first-child:before {
          
          background-color: rgba(201, 128, 19);
        }
        
        /* ligne paire 
        { .even {
          background-color: rgba(92, 91, 97, 0.3);
        } }
        
        
        /* ligne impaire 
        {.odd {
          background-color: rgba(200, 173, 127, 0.3);
        } }
        */
        
        /* ligne selectionné */
        table.dataTable tbody>tr.selected,
        table.dataTable tbody>tr>.selected {
          background-color: rgb(201, 128, 19, 0.5);
        }
        
        /* numérotation des pages mais qui marche moyen   */
        
        /* .page-item.active {
          z-index: 1;
          color: #000000;
          background-color: rgba(201, 128, 19);
          border-color: rgba(201, 128, 19);
        }
        
        .page-link{
          color: #000000;
          background-color: rgba(201, 128, 19);
          border-color: rgba(201, 128, 19);
        } */



      </style>
      
      </html>