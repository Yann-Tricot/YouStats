<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!--Nouveaux imports-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>  -->
      <!--Générateur de pdf -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
      <!--Double click et autre fonctionnalités (je pense)-->
      <script type="text/javascript"  src="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.js" defer></script>
      <script type="text/javascript"  src="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.js"></script>
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.23/af-2.3.5/b-1.6.5/b-colvis-1.6.5/b-flash-1.6.5/b-html5-1.6.5/b-print-1.6.5/cr-1.5.3/fc-3.3.2/fh-3.1.7/kt-2.5.3/r-2.2.6/rg-1.1.2/rr-1.2.7/sc-2.0.3/sb-1.0.1/sp-1.2.2/sl-1.3.1/datatables.min.css" />
      <!--Le tableau en lui meme-->
      <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" defer ></script>
      <script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap.min.js" defer></script>
      <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" defer></script> 

      <!--Import des boutons-->
      <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"defer></script>
      <script src="https://cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js"defer></script>
      <script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"defer></script>
      <script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.flash.min.js"defer></script>  
      <script src="https://cdn.datatables.net/colreorder/1.5.3/js/dataTables.colReorder.min.js"defer></script>  
   </head>
   <body>
      <div class="container">
         <h1>Test de dataTable</h1>
      </div>
      <div class="col-xl">
         <div class="col-xl">
            <table class="table" id="myDatatable">
               <thead>
                  <tr>
                     <th><strong>Titre de la vidéo</strong></th>
                     <th><strong>ID</strong></th>
                     <th><strong>Tag ID</strong></th>
                     <th><strong>Pays</strong></th>
                     <th><strong>Channel ID</strong></th>
                     <th><strong>Catégorie ID</strong></th>
                     <th><strong>Nombre de commentaire</strong></th>
                     <th><strong>Nombre de j'aime</strong></th>
                     <th><strong>Nombre de j'aime pas </strong></th>
                     <th><strong>Date de publication</strong></th>
                     <th><strong>Date de tendance</strong></th>
                     <th><strong>MiniatureLink</strong></th>
                  </tr>
               </thead>
               <tbody>
               </tbody>
               <tfoot>
                  <tr>
                     <th><strong>Titre de la vidéo</strong></th>
                     <th><strong>ID</strong></th>
                     <th><strong>Tag ID</strong></th>
                     <th><strong>Pays</strong></th>
                     <th><strong>Channel ID</strong></th>
                     <th><strong>Catégorie ID</strong></th>
                     <th><strong>Nombre de commentaire</strong></th>
                     <th><strong>Nombre de j'aime</strong></th>
                     <th><strong>Nombre de j'aime pas </strong></th>
                     <th><strong>Date de publication</strong></th>
                     <th><strong>Date de tendance</strong></th>
                     <th><strong>MiniatureLink</strong></th>
                  </tr>
               </tfoot>
            </table>
         </div>
         <!-- modal -->
         <div class="modal fade bd-example-modal-lg" id="modalTab" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
               <div class="modal-content">
                  <div class="modal-header">
                     <!-- <button type="button" class="close" data-dismiss="modal" aria-hidden="true">�</button> -->
                     <h3 class="modal-title">Video</h3>
                  </div>
                  <div class="modal-body">
                     <div class="container">
                        <div class="row">
                           <div id="imageMiniature" class="col"></div>
                           <div class="col">
                              <h5>Titre : </h5>
                              <div id="titre">
                              </div>

                              <h5 >Chaine</h5>
                              <div id="chaine">
                              </div>


                           </div>
                        </div>
                     </div>
                     <div class="row">
                        <div class="col">
                         <div class="card">
                              <div class="card-body">
                                 <div class="table-responsive">
                                    <table >
                                       <tbody>
                                         
                                          <tr>
                                             <td>Tag :</td>
                                             <td id ="tag"> </td>
                                          </tr>
                                          <tr>
                                              <td>Pays : </td>                                          
                                             <td id ="pays"> Tag </td>
                                          </tr>
                                          <tr>
                                              <td>Catégorie : </td>
                                             <td id ="cat"> Tag </td>
                                          </tr>                                      
                                          <tr>
                                            <td>Nombre de commentaires : </td>
                                             <td id ="comment"> Tag </td>
                                          </tr>
                                          <tr>
                                            <td>Nombre de j'aime : </td>
                                             <td id ="like"> Tag </td>
                                          </tr>
                                          <tr>
                                            <td>Nombre de j'aime pas : </td>
                                             <td id ="dislike"> Tag </td>
                                          </tr>
                                          <tr>
                                           <td>Date de publication : </td>
                                             <td id ="published"> Tag </td>
                                          </tr>
                                          <tr>
                                            <td>Date de tendance : </td>
                                             <td id ="trending"> Tag </td>
                                          </tr>
                                    </table>
                                 </div>
                              </div>
                           </div> 
                        </div>                        
                        <div class="col">
                        </div>
                     </div>
                     <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                     </div>
                  </div>
                  <!-- /.modal-content -->
               </div>
               <!-- /.modal-dialog -->
            </div>
         </div>
      </div>
   </body>
      
      
      <script>


      var data = [];

        {% for v in 0..598%}
        var object = {
          "Title" : "{{videos[loop.index].getVidTitle}}",
          "Id" : "{{videos[loop.index].getId}}",
          "Tag" : "{{videos[loop.index].getVidTagId}}",
          "Country" : "{{videos[loop.index].getVidCountry}}",
          "ChannelId" : "{{videos[loop.index].getVidChannelId}}",
          "CategoryId" : "{{videos[loop.index].getVidCategoryId}}",
          "CommentCount" : "{{videos[loop.index].getVidCommentCount}}",
          "DislikeCount": "{{videos[loop.index].getVidDislikeCount}}",
          "LikeCount" : "{{videos[loop.index].getVidLikeCount}}",
          "PublishedDate" : "{{videos[loop.index].getVidPublishDate|date('d-m-Y')}}",
          "TrendingDate :" : "{{videos[loop.index].getVidTrendingDate|date('d-m-Y')}}",
          "MiniatureLink" : "{{videos[loop.index].getMiniatureLink}}",

        }; 

          data.push(object);
        {% endfor %}       
        
        var cors = "http://cors-anywhere.herokuapp.com/";   

        $(document).ready(function () {
          
          $('#myDatatable').DataTable({
            data: data,
            dom :"Bfrtip",
            columns: [ 
              {
                data: "Title",    
                defaultContent: '-'            
              },
             
              {
                data: "Id",  
              },
              {
                data: "Tag", 
              },
              {
                data: "Country",
              }, 
              {
                data: "ChannelId",
              },
              {
                data: "CategoryId",                
              },
              {
                data: "CommentCount", 
              }, 
              {
                data: "LikeCount",
              },
              {
                data: "DislikeCount",
              },
              {
                data: "PublishedDate", 
              },
              {

                data: "TrendingDate :",
              },
                {
                data: "MiniatureLink",
                "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                $(nTd).html("<a target=_blank href='"+sData+"'>"+sData+"</a>");
                },

             },           
            
            ],

            responsive: true,
            paging: true,
            fixedHeader: true,
            searching: true,
            colReorder: true,
            select: true,
            keys: true,
            paginate:
            {
              "previous": "Previous page"
            },
            rowReorder: false,
            lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
            pageLength: 15,
            initComplete: function () {
              this.api().columns().every(function () {
                var that = this;                
                $('input', this.footer()).on('keyup change clear', function () {
                  if (that.search() !== this.value) {
                    that
                    .search(this.value)
                    .draw();
                  }
                });
              });
            },
            buttons: [
            { extend: 'csv', className: 'btn btn-secondary testBouton' },
            { extend: 'excel', className: 'btn btn-secondary testBouton' },
            { extend: 'pdfHtml5', className: 'btn btn-secondary testBouton', orientation: 'landscape', pageSize: 'A3' },
            { extend: 'print', className: 'btn btn-secondary testBouton' },
            ]
          })
        });      
        
        
        $('#myDatatable tfoot th').each(function () {
          var title = $('table tfoot th').eq($(this).index()).text();
          $(this).html('<input type="text" placeholder="Search ' + title + '" />');
        });
        
        $.extend(true, $.fn.dataTable.defaults, {
          columnDefs: [
          {
            targets: '_all',
            defaultContent: '-'
          }
          ],
          language: {
            processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>Processing...'
          },
        });
        
        $('#myDatatable tbody').on('dblclick', 'tr', function (e, dt, type, indexes) {  

          //évite les bugs 
          if (e.currentTarget.className != "child" )
          {
            var lien = cors + data["MiniatureLink"];
            console.log($('td', this).eq(11).text());
            var lien2 = cors + "https://www.google.com/url?sa=i&url=https%3A%2F%2Fdeveloper.mozilla.org%2Ffr%2Fdocs%2FWeb%2FHTML%2FElement%2FImg&psig=AOvVaw18gr0YP4N_5daIKW_ssPag&ust=1606481499287000&source=images&cd=vfe&ved=0CAIQjRxqFwoTCKC8_JagoO0CFQAAAAAdAAAAABAD";
            var elt = document.getElementById("imageMiniature");
            elt.innerHTML = '';
            var titre = $('td', this).eq(0).text();
            var id =  $('td', this).eq(1).text();
            var tagId =  $('td', this).eq(2).text();
            var country = $('td', this).eq(3).text();
            var channelID =  $('td', this).eq(4).text();
            var categoryID =  $('td', this).eq(5).text();
            var CommentCount = + $('td', this).eq(6).text();
            var LikeCount = $('td', this).eq(7).text();
            var DislikeCount =  $('td', this).eq(8).text();
            var PublishedDate = $('td', this).eq(9).text();
            var TrendingDate =  $('td', this).eq(10).text();
            var link = cors + $('td', this).eq(11).text();
            console.log(link);

            $('#modalTab').modal("show");

            $('#titre').text(titre);
            $('#chaine').text(id);
            $('#tag').text(tagId);
            $('#pays').text(country);
            $('#cat').text(categoryID);
            $('#comment').text(CommentCount);
            $('#like').text(LikeCount);
            $('#dislike').text(DislikeCount);
            $('#published').text(PublishedDate);
            $('#trending').text(TrendingDate);
            var img = document.createElement("img");
            img.crossOrigin = "anonymous";
            img.src = link;
            img.setAttribute('width', '100%');
            img.setAttribute('height', '100%');
            elt.appendChild(img);
          }

 
        });
       
      </script>
      
      <style>

      li[data-dtr-index='11'] {
          visibility : hidden;  
        }
        .dataTables_processing {
          z-index: 3000;
        }
        
        .btn-primary {
          background-color: #4e73df;
          border-color: #4e73df;
          left: 25px;
        }
        
        .ui-state-active {
          background-color: rgba(97, 134, 255, 0.993);
          color: black;
          font-weight: bold;
        }
        
        .ui-autocomplete {
          max-height: 200px;
          overflow-y: scroll;
          overflow-x: hidden;
        }
        
        .list-group-item {
          right: 20px;
        }
        
        /* couleur des boutons */
        .testBouton {
          background-color: rgb(201, 128, 19);
          border-color: rgb(201, 128, 19);
        }
        
        
        /* couleur des boutons plus et moins */
        table.dataTable.dtr-inline.collapsed>tbody>tr[role="row"]>td:first-child:before,
        table.dataTable.dtr-inline.collapsed>tbody>tr[role="row"]>th:first-child:before {
          
          background-color: rgba(201, 128, 19);
        }
        
        /* ligne paire 
        { .even {
          background-color: rgba(92, 91, 97, 0.3);
        } }
        
        
        /* ligne impaire 
        {.odd {
          background-color: rgba(200, 173, 127, 0.3);
        } }
        */
        
        /* ligne selectionné */
        table.dataTable tbody>tr.selected,
        table.dataTable tbody>tr>.selected {
          background-color: rgb(201, 128, 19, 0.5);
        }
        
        /* numérotation des pages mais qui marche moyen   */
        
        /* .page-item.active {
          z-index: 1;
          color: #000000;
          background-color: rgba(201, 128, 19);
          border-color: rgba(201, 128, 19);
        }
        
        .page-link{
          color: #000000;
          background-color: rgba(201, 128, 19);
          border-color: rgba(201, 128, 19);
        } */
      </style>
      
      </html>